<nav class="dashboard-nav">
  <div class="nav-container">
    <div class="nav-logo">
      <a routerLink="/dashboard" class="logo-link">
        <span class="logo-icon">ğŸ’°</span>
        <span class="logo-text">FinancialApp</span>
      </a>
    </div>

    <div class="nav-menu">
      <a routerLink="/dashboard" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">ğŸ“Š</span>
        <span class="nav-label">Dashboard</span>
      </a>
      <a routerLink="/transactions" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">ğŸ’°</span>
        <span class="nav-label">TransaÃ§Ãµes</span>
      </a>
      <a routerLink="/reports" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">ğŸ“ˆ</span>
        <span class="nav-label">RelatÃ³rios</span>
      </a>
    </div>

    <div class="nav-user">
      <div class="user-info" (click)="toggleUserMenu()" #userMenu>
        <div class="user-avatar">
          {{ getUserInitials() }}
        </div>
        <div class="user-details">
          <span class="user-name">{{ userName }}</span>
          <span class="user-role">{{ userRole }}</span>
        </div>
        <span class="dropdown-icon">â–¼</span>
        
        <div class="dropdown-menu" *ngIf="showUserMenu">
          <!-- <a routerLink="/profile" class="dropdown-item">
            <span class="dropdown-icon">ğŸ‘¤</span>
            Meu Perfil
          </a> -->
          <!-- <a routerLink="/settings" class="dropdown-item">
            <span class="dropdown-icon">âš™ï¸</span>
            ConfiguraÃ§Ãµes
          </a> -->
          <!-- <div class="dropdown-divider"></div> -->
          <button class="dropdown-item logout" (click)="logout()">
            <span class="dropdown-icon">ğŸšª</span>
            Sair
          </button>
        </div>
      </div>
    </div>
  </div>
</nav>

<div class="dashboard-container">
  <!-- Welcome Header -->
  <div class="welcome-header">
    <div>
      <h1>OlÃ¡, {{ userName }}! ğŸ‘‹</h1>
      <p class="welcome-date">{{ currentDate | date:'EEEE, d \'de\' MMMM \'de\' yyyy' }}</p>
    </div>
    <div class="header-actions">
      <button class="btn-icon" (click)="refreshData()" [class.rotating]="isRefreshing">
        ğŸ”„
      </button>
      <button class="btn btn-primary" routerLink="/transactions/new">
        <span class="btn-icon">+</span>
        Nova TransaÃ§Ã£o
      </button>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="summary-cards">
    <div class="summary-card" *ngFor="let card of summaryCards">
      <div class="summary-icon" [style.background]="card.bgColor">
        {{ card.icon }}
      </div>
      <div class="summary-info">
        <span class="summary-label">{{ card.label }}</span>
        <span class="summary-value" [class]="card.valueClass">{{ card.value }}</span>
        <span class="summary-change" [class.positive]="card.change > 0" [class.negative]="card.change < 0">
          {{ card.change > 0 ? '+' : '' }}{{ card.change }}%
        </span>
      </div>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="charts-row">
    <div class="chart-card">
      <div class="chart-header">
        <h3>Fluxo de Caixa</h3>
        <select class="chart-period" [(ngModel)]="cashFlowPeriod" (change)="loadCashFlowData()">
          <option value="week">Ãšltima Semana</option>
          <option value="month">Ãšltimo MÃªs</option>
          <option value="year">Ãšltimo Ano</option>
        </select>
      </div>
      <div class="chart-container">
        <canvas id="cashFlowChart"></canvas>
      </div>
    </div>

    <div class="chart-card">
      <div class="chart-header">
        <h3>DistribuiÃ§Ã£o por Categoria</h3>
        <select class="chart-period" [(ngModel)]="categoryPeriod" (change)="loadCategoryData()">
          <option value="receivable">Receitas</option>
          <option value="payable">Despesas</option>
        </select>
      </div>
      <div class="chart-container">
        <canvas id="categoryChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Recent Transactions and Daily Extract -->
  <div class="content-row">
    <!-- Recent Transactions -->
    <div class="recent-card">
      <div class="card-header">
        <h3>TransaÃ§Ãµes Recentes</h3>
        <a routerLink="/transactions" class="view-all">Ver todas â†’</a>
      </div>

      <div class="transaction-list">
        <div class="transaction-item" *ngFor="let transaction of recentTransactions">
          <div class="transaction-icon" [class.receivable]="transaction.type === 'receivable'" [class.payable]="transaction.type === 'payable'">
            {{ transaction.type === 'receivable' ? 'ğŸ“¥' : 'ğŸ“¤' }}
          </div>
          
          <div class="transaction-info">
            <div class="transaction-main">
              <span class="transaction-description">{{ transaction.description }}</span>
              <span class="transaction-amount" [class.receivable]="transaction.type === 'receivable'" [class.payable]="transaction.type === 'payable'">
                {{ transaction.type === 'receivable' ? '+' : '-' }}{{ transaction.amount | currency:'BRL' }}
              </span>
            </div>
            
            <div class="transaction-details">
              <span class="transaction-date">{{ transaction.dueDate | date:'dd/MM' }}</span>
              <span class="transaction-category" *ngIf="transaction.category">{{ transaction.category }}</span>
              <span class="badge" [class]="getStatusClass(transaction.status)">
                {{ getStatusLabel(transaction.status) }}
              </span>
            </div>
          </div>
        </div>

        <div class="no-data" *ngIf="recentTransactions.length === 0">
          <p>Nenhuma transaÃ§Ã£o recente</p>
        </div>
      </div>
    </div>

    <!-- Daily Extract -->
    <div class="extract-card">
      <div class="card-header">
        <h3>Extrato do Dia</h3>
        <div class="extract-controls">
          <button class="btn-icon" (click)="previousDay()" [disabled]="isToday()">
            â†
          </button>
          <span class="extract-date">{{ selectedDate | date:'dd/MM/yyyy' }}</span>
          <button class="btn-icon" (click)="nextDay()">
            â†’
          </button>
        </div>
      </div>

      <div class="daily-balance" *ngIf="dailyExtract">
        <div class="balance-item">
          <span>Saldo Inicial</span>
          <strong>{{ dailyExtract.balance.openingBalance | currency:'BRL' }}</strong>
        </div>
        <div class="balance-item incoming">
          <span>Entradas</span>
          <strong>+ {{ dailyExtract.balance.incoming | currency:'BRL' }}</strong>
        </div>
        <div class="balance-item outgoing">
          <span>SaÃ­das</span>
          <strong>- {{ dailyExtract.balance.outgoing | currency:'BRL' }}</strong>
        </div>
        <div class="balance-item total">
          <span>Saldo Final</span>
          <strong [class.positive]="dailyExtract.balance.closingBalance > 0" 
                  [class.negative]="dailyExtract.balance.closingBalance < 0">
            {{ dailyExtract.balance.closingBalance | currency:'BRL' }}
          </strong>
        </div>
      </div>

      <div class="extract-list">
        <div class="extract-item" *ngFor="let transaction of dailyExtract?.transactions">
          <div class="extract-time">{{ transaction.createdAt | date:'HH:mm' }}</div>
          <div class="extract-description">{{ transaction.description }}</div>
          <div class="extract-amount" [class.receivable]="transaction.type === 'receivable'" [class.payable]="transaction.type === 'payable'">
            {{ transaction.type === 'receivable' ? '+' : '-' }}{{ transaction.amount | currency:'BRL' }}
          </div>
        </div>

        <div class="no-data" *ngIf="!dailyExtract?.transactions?.length">
          <p>Nenhuma movimentaÃ§Ã£o neste dia</p>
        </div>
      </div>

      <div class="extract-footer">
        <button class="btn-link" (click)="viewFullExtract()">
          Ver extrato completo â†’
        </button>
      </div>
    </div> 
  </div>

  <!-- Upcoming Payments -->
  <div class="upcoming-card">
    <div class="card-header">
      <h3>PrÃ³ximos Vencimentos</h3>
      <a routerLink="/transactions" class="view-all">Ver todos â†’</a>
    </div>

    <div class="upcoming-list">
      <div class="upcoming-item" *ngFor="let transaction of upcomingPayments">
        <div class="upcoming-info">
          <span class="upcoming-description">{{ transaction.description }}</span>
          <span class="upcoming-date">{{ transaction.dueDate | date:'dd/MM' }}</span>
        </div>
        <span class="upcoming-amount">{{ transaction.amount | currency:'BRL' }}</span>
        <span class="badge" [class]="getDaysClass(transaction)">
          {{ getDaysUntil(transaction) }}
        </span>
      </div>

      <div class="no-data" *ngIf="upcomingPayments.length === 0">
        <p>Nenhum pagamento prÃ³ximo</p>
      </div>
    </div>
  </div>
</div>